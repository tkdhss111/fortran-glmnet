# Source directory CMakeLists.txt

# Define source files
set(GLMNET_SOURCES
    glmnet.f
)

set(WRAPPER_SOURCES
    glmnet_wrapper.f90
)

# Create library target
if(BUILD_SHARED_LIBS)
    add_library(glmnet_wrapper SHARED ${GLMNET_SOURCES} ${WRAPPER_SOURCES})
    message(STATUS "Building shared library")
else()
    add_library(glmnet_wrapper STATIC ${GLMNET_SOURCES} ${WRAPPER_SOURCES})
    message(STATUS "Building static library")
endif()

# Set library properties
set_target_properties(glmnet_wrapper PROPERTIES
    VERSION ${PROJECT_VERSION}
    SOVERSION ${PROJECT_VERSION_MAJOR}
    Fortran_MODULE_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
    POSITION_INDEPENDENT_CODE ON
)

# Compiler-specific flags for glmnet.f (legacy Fortran)
if(CMAKE_Fortran_COMPILER_ID MATCHES "GNU")
    set_source_files_properties(glmnet.f PROPERTIES
        COMPILE_FLAGS "-std=legacy -w"
    )
elseif(CMAKE_Fortran_COMPILER_ID MATCHES "Intel")
    set_source_files_properties(glmnet.f PROPERTIES
        COMPILE_FLAGS "-std08 -warn nousage"
    )
endif()

# Add OpenMP if enabled
if(ENABLE_OPENMP AND OpenMP_Fortran_FOUND)
    target_link_libraries(glmnet_wrapper PUBLIC OpenMP::OpenMP_Fortran)
endif()

# Add MKL if enabled
if(ENABLE_MKL AND MKL_FOUND)
    target_link_libraries(glmnet_wrapper PUBLIC MKL::MKL)
endif()

# Include directories for module files
target_include_directories(glmnet_wrapper
    PUBLIC
        $<BUILD_INTERFACE:${CMAKE_CURRENT_BINARY_DIR}>
        $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}>
)

# Installation is handled in main CMakeLists.txt
